================================================================================
RAPPORT DE SCAN - CONNEXIONS NON STANDARDISÃ‰ES
================================================================================

ðŸ“Š STATISTIQUES:
   â€¢ Fichiers avec violations: 57
   â€¢ Total de violations: 259

ðŸ“‹ VIOLATIONS PAR TYPE:

  psycopg_connect: 52 occurrences dans 45 fichiers
  os_getenv_payroll: 155 occurrences dans 42 fichiers
  os_getenv_database: 24 occurrences dans 24 fichiers
  create_engine: 6 occurrences dans 5 fichiers
  os_getenv_pgpassword: 22 occurrences dans 17 fichiers

================================================================================
DÃ‰TAILS PAR FICHIER
================================================================================

ðŸ“„ _cleanup_report/check_db_conn.py
   â€¢ psycopg_connect: lignes 69
   â€¢ os_getenv_payroll: lignes 17, 18, 32
   â€¢ os_getenv_database: lignes 32
   â€¢ os_getenv_pgpassword: lignes 17

ðŸ“„ _cleanup_report/list_paie_views.py
   â€¢ psycopg_connect: lignes 8

ðŸ“„ _cleanup_report/query_kpi_db.py
   â€¢ psycopg_connect: lignes 179
   â€¢ os_getenv_payroll: lignes 24, 25, 27
   â€¢ os_getenv_database: lignes 27
   â€¢ os_getenv_pgpassword: lignes 24

ðŸ“„ agent/knowledge_index.py
   â€¢ os_getenv_payroll: lignes 21
   â€¢ os_getenv_database: lignes 21

ðŸ“„ alembic/env.py
   â€¢ os_getenv_database: lignes 52

ðŸ“„ analyser_code_paie_pour_categories.py
   â€¢ psycopg_connect: lignes 29

ðŸ“„ archive/logic/db_optimizer.py
   â€¢ os_getenv_payroll: lignes 27
   â€¢ os_getenv_database: lignes 27

ðŸ“„ archive/scripts/tests/test_views_ok.py
   â€¢ psycopg_connect: lignes 48
   â€¢ os_getenv_payroll: lignes 20
   â€¢ os_getenv_database: lignes 20

ðŸ“„ calc_net.py
   â€¢ psycopg_connect: lignes 10

ðŸ“„ config/config_manager.py
   â€¢ os_getenv_payroll: lignes 20, 21, 22, 23, 24, 25, 26

ðŸ“„ config/connection_standard.py
   â€¢ psycopg_connect: lignes 263
   â€¢ os_getenv_payroll: lignes 75, 78, 90, 91, 92, 93, 94, 296, 297, 298, 299, 300, 302
   â€¢ os_getenv_pgpassword: lignes 78, 94, 301

ðŸ“„ config/settings.py
   â€¢ os_getenv_payroll: lignes 56, 57, 129, 132
   â€¢ os_getenv_database: lignes 129
   â€¢ os_getenv_pgpassword: lignes 56, 122, 132

ðŸ“„ config_manager_backup_20251110_005646.py
   â€¢ psycopg_connect: lignes 110
   â€¢ os_getenv_payroll: lignes 85, 96, 100, 101, 102, 103
   â€¢ os_getenv_database: lignes 96

ðŸ“„ connect_check.py
   â€¢ psycopg_connect: lignes 12

ðŸ“„ corriger_types_colonnes_complet.py
   â€¢ psycopg_connect: lignes 29
   â€¢ os_getenv_payroll: lignes 25, 26

ðŸ“„ corriger_types_complet_final.py
   â€¢ psycopg_connect: lignes 29
   â€¢ os_getenv_payroll: lignes 24, 25

ðŸ“„ corriger_types_montants_execute.py
   â€¢ psycopg_connect: lignes 22
   â€¢ os_getenv_payroll: lignes 19, 20

ðŸ“„ count_columns.py
   â€¢ psycopg_connect: lignes 15

ðŸ“„ export_employees_json.py
   â€¢ psycopg_connect: lignes 42
   â€¢ os_getenv_payroll: lignes 7
   â€¢ os_getenv_database: lignes 7

ðŸ“„ get_db_overview.py
   â€¢ psycopg_connect: lignes 19

ðŸ“„ inspect_view.py
   â€¢ create_engine: lignes 85
   â€¢ os_getenv_payroll: lignes 15, 27, 28, 29, 30, 31
   â€¢ os_getenv_database: lignes 15
   â€¢ os_getenv_pgpassword: lignes 28

ðŸ“„ launch_debug.py
   â€¢ psycopg_connect: lignes 45
   â€¢ os_getenv_payroll: lignes 33

ðŸ“„ launch_payroll.py
   â€¢ psycopg_connect: lignes 87
   â€¢ os_getenv_payroll: lignes 30, 31, 32, 33, 34, 35, 36, 38

ðŸ“„ lister_toutes_colonnes_table.py
   â€¢ psycopg_connect: lignes 35
   â€¢ os_getenv_payroll: lignes 20, 22, 23, 24, 25, 26

ðŸ“„ logic/audit.py
   â€¢ os_getenv_payroll: lignes 109
   â€¢ os_getenv_database: lignes 109

ðŸ“„ migration/backup_database.py
   â€¢ os_getenv_payroll: lignes 13, 98

ðŸ“„ payroll_app_qt_Version4.py
   â€¢ psycopg_connect: lignes 825

ðŸ“„ providers/postgres_provider.py
   â€¢ psycopg_connect: lignes 162
   â€¢ os_getenv_payroll: lignes 146, 153, 157
   â€¢ os_getenv_database: lignes 146
   â€¢ os_getenv_pgpassword: lignes 157

ðŸ“„ run_validate.py
   â€¢ psycopg_connect: lignes 21, 104, 121, 129, 135
   â€¢ os_getenv_payroll: lignes 8
   â€¢ os_getenv_database: lignes 8

ðŸ“„ run_verify_datatables_employees.py
   â€¢ psycopg_connect: lignes 59
   â€¢ os_getenv_payroll: lignes 55
   â€¢ os_getenv_database: lignes 55

ðŸ“„ scripts/_run_single_view_create.py
   â€¢ psycopg_connect: lignes 37

ðŸ“„ scripts/admin_setup_kpi_views.py
   â€¢ psycopg_connect: lignes 31
   â€¢ os_getenv_payroll: lignes 17

ðŸ“„ scripts/apply_harmonization.py
   â€¢ psycopg_connect: lignes 34
   â€¢ os_getenv_payroll: lignes 20, 21
   â€¢ os_getenv_pgpassword: lignes 20

ðŸ“„ scripts/apply_sql_file_postgres.py
   â€¢ psycopg_connect: lignes 30

ðŸ“„ scripts/check_existing_views.py
   â€¢ psycopg_connect: lignes 34
   â€¢ os_getenv_payroll: lignes 19, 20
   â€¢ os_getenv_pgpassword: lignes 19

ðŸ“„ scripts/check_status_constraint.py
   â€¢ psycopg_connect: lignes 13
   â€¢ os_getenv_payroll: lignes 7, 8, 9, 10, 11
   â€¢ os_getenv_pgpassword: lignes 11

ðŸ“„ scripts/check_table_structure.py
   â€¢ psycopg_connect: lignes 41
   â€¢ os_getenv_payroll: lignes 19, 20, 25, 26, 27, 28, 29
   â€¢ os_getenv_database: lignes 25
   â€¢ os_getenv_pgpassword: lignes 19

ðŸ“„ scripts/create_simple_kpi_views.py
   â€¢ psycopg_connect: lignes 41
   â€¢ os_getenv_payroll: lignes 19, 20, 25, 26, 27, 28, 29
   â€¢ os_getenv_database: lignes 25
   â€¢ os_getenv_pgpassword: lignes 19

ðŸ“„ scripts/create_view_direct.py
   â€¢ psycopg_connect: lignes 40

ðŸ“„ scripts/dump_analytics_figures.py
   â€¢ create_engine: lignes 37
   â€¢ os_getenv_payroll: lignes 10, 22, 23, 24, 25, 26
   â€¢ os_getenv_database: lignes 10
   â€¢ os_getenv_pgpassword: lignes 23

ðŸ“„ scripts/import_excel_to_staging.py
   â€¢ psycopg_connect: lignes 164

ðŸ“„ scripts/mettre_a_jour_categories_titres_postgres.py
   â€¢ psycopg_connect: lignes 75, 133

ðŸ“„ scripts/refactor_connections.py
   â€¢ psycopg_connect: lignes 8, 149
   â€¢ create_engine: lignes 9, 150
   â€¢ os_getenv_payroll: lignes 151

ðŸ“„ scripts/reset_db_passwords.py
   â€¢ psycopg_connect: lignes 28, 31
   â€¢ os_getenv_payroll: lignes 13, 18, 19, 20, 21
   â€¢ os_getenv_pgpassword: lignes 13, 18

ðŸ“„ scripts/setup_schema_permissions.py
   â€¢ psycopg_connect: lignes 41
   â€¢ os_getenv_payroll: lignes 19, 20, 25, 26, 27, 28, 29
   â€¢ os_getenv_database: lignes 25
   â€¢ os_getenv_pgpassword: lignes 19

ðŸ“„ scripts/smoke_db_conn.py
   â€¢ psycopg_connect: lignes 15

ðŸ“„ scripts/test_analytics_views.py
   â€¢ create_engine: lignes 39
   â€¢ os_getenv_payroll: lignes 11, 23, 25, 26, 27, 28
   â€¢ os_getenv_database: lignes 11
   â€¢ os_getenv_pgpassword: lignes 25

ðŸ“„ scripts/verification_coherence_colonnes.py
   â€¢ psycopg_connect: lignes 74
   â€¢ os_getenv_payroll: lignes 14, 15, 16, 17, 18
   â€¢ os_getenv_database: lignes 14

ðŸ“„ scripts/verification_coherence_complete.py
   â€¢ psycopg_connect: lignes 67
   â€¢ os_getenv_payroll: lignes 14, 15, 16, 17, 18
   â€¢ os_getenv_database: lignes 14

ðŸ“„ scripts/verify_kpi_columns.py
   â€¢ psycopg_connect: lignes 146
   â€¢ os_getenv_payroll: lignes 20, 21, 26, 27, 28, 29, 30
   â€¢ os_getenv_database: lignes 26
   â€¢ os_getenv_pgpassword: lignes 20

ðŸ“„ services/etl_paie.py
   â€¢ psycopg_connect: lignes 152
   â€¢ os_getenv_payroll: lignes 994

ðŸ“„ services/schema_editor.py
   â€¢ os_getenv_payroll: lignes 146

ðŸ“„ show_columns.py
   â€¢ psycopg_connect: lignes 19

ðŸ“„ test_app_simple.py
   â€¢ psycopg_connect: lignes 24
   â€¢ os_getenv_payroll: lignes 16, 23
   â€¢ os_getenv_pgpassword: lignes 17

ðŸ“„ tests/legacy/providers/hybrid_provider.py
   â€¢ psycopg_connect: lignes 66
   â€¢ os_getenv_payroll: lignes 43, 59
   â€¢ os_getenv_database: lignes 44

ðŸ“„ tmp_check_employees.py
   â€¢ create_engine: lignes 34
   â€¢ os_getenv_payroll: lignes 11, 23, 24, 25, 26, 27
   â€¢ os_getenv_database: lignes 11

ðŸ“„ trouver_table_source_reelle.py
   â€¢ psycopg_connect: lignes 23
   â€¢ os_getenv_payroll: lignes 20, 21

================================================================================
ACTIONS RECOMMANDÃ‰ES
================================================================================

1. Refactoriser les fichiers listÃ©s ci-dessus
2. Remplacer psycopg.connect() par get_connection_pool()
3. Remplacer create_engine() par get_connection_pool()
4. Remplacer os.getenv('PAYROLL_*') par get_dsn()
5. Tester chaque fichier modifiÃ©
